<#include "../common/common.html"/>

<div class="row">
	<div class="col-xs-12">
		<div class="row">
			<div class="col-xs-12">
				<div class="widget-box">
					<div class="widget-header widget-header-small">
						<h5 class="widget-title lighter">Search Bar</h5>
					</div>

					<div class="widget-body">
						<div class="widget-main">
							<form id="_form" class="form-inline">
								<label>
									<label class="control-label" for="form-field-1"> Name: </label>
									<input name="name" type="text" class="form-data input-medium search-data">
								</label>
								<!--
								<button id="_search" type="button" class="btn btn-info btn-sm">
									<i class="ace-icon fa fa-search bigger-110"></i>Search
								</button>
								 -->
							</form>
						</div>
					</div>
				</div>

				<div>
					<div class="dataTables_wrapper form-inline no-footer">
						<table id="_table" class="table table-striped table-bordered table-hover dataTable no-footer">
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<a id="my-modal-a" href="#my-modal" role="button" class="bigger-125 bg-primary white" style="display: none;" data-toggle="modal"></a>

	<div id="my-modal" class="modal fade" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h3 class="smaller lighter blue no-margin">View Application Credentials</h3>
				</div>

				<div class="modal-body">
					<form id="_editForm" class="form-horizontal" role="form"
						  validate="true">

						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right"><span class="form-star">*</span>ClientId</label>

							<div class="col-sm-9">
								<label id="_clientId" class="control-label"></label>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-3 control-label no-padding-right"><span class="form-star">*</span>ClientSecret</label>

							<div class="col-sm-9">
								<label id="_clientSecret" class="control-label"></label>
							</div>
						</div>
					</form>
				</div>

				<div class="modal-footer">
					<button id="_cancel" class="btn btn-sm btn-danger pull-right" data-dismiss="modal" type="reset" >
						<i class="ace-icon fa fa-times"></i>
						Close
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div>
</div>

<script type="text/javascript">
	$('.page-content-area').ace_ajax('loadScripts', scripts, function() {
		jQuery(function($) {
			// List
			var $table = $("#_table").table({
				url : "${request.contextPath}/admin/app/list",
				formId : "_form",
				tools : [
					{text : 'Add', clazz : 'btn-info', icon : 'fa fa-plus-circle blue', permission : '/admin/app/edit', handler : function(){
							$.aceRedirect("${request.contextPath}/admin/app/edit");
						}},
					{text : 'Disable', clazz : 'btn-warning', icon : 'fa fa-lock orange', permission : '/admin/app/enable', handler : function(){
							$table.ajaxEnable({url : "${request.contextPath}/admin/app/enable"}, false);
						}},
					{text : 'Enable', clazz : 'btn-success', icon : 'fa fa-unlock green', permission : '/admin/app/enable', handler : function(){
							$table.ajaxEnable({url : "${request.contextPath}/admin/app/enable"}, true);
						}},
					{text : 'Delete', clazz : 'btn-danger', icon : 'fa fa-trash-o red', permission : '/admin/app/delete', handler : function(){
							$table.ajaxDelete({
								confirm : "Deleting the application will also delete associated permissions. Confirm deletion?",
								url : "${request.contextPath}/admin/app/delete"
							});
						}},
					{text : 'View Application Credentials', clazz : 'blue', icon : 'fa fa-eye', permission : '/admin/app/credentials', handler : function(){
							if($table.validateSelected(true)){
								$("#_editForm")[0].reset();
								$.getJSON("${request.contextPath}/admin/app/credentials?id=" + $table.getSelectedItemKeys("id"), function(d) {
									$("#_clientId").html(d.data.clientId);
									$("#_clientSecret").html(d.data.clientSecret);
									$("#my-modal-a").click();
								});
							}
						}}
				],
				columns : [
					{field:'id', hide : true},
					{field:'isEnable', hide : true},
					{field:'name', title:'Name', align:'left'},
					{field:'code', title:'Code', align:'left', mobileHide : true},
					{field:'sort', title:'Sort', mobileHide : true},
					{field:'isEnableStr', title:'Enabled', replace : function (d){
							if(d.isEnable)
								return "<span class='label label-sm label-success'>Yes</span>";
							else
								return "<span class='label label-sm label-warning'>No</span>";
						}},
					{field:'createTime', title:'Created Time', mobileHide : true}
				],
				operate : [
					{text : 'Edit', clazz : 'blue', icon : 'fa fa-pencil', permission : '/admin/app/edit', handler : function(d, i){
							$.aceRedirect("${request.contextPath}/admin/app/edit?id=" + d.id);
						}},
					{text : 'Disable', clazz : 'orange', icon : 'fa fa-lock', permission : '/admin/app/enable',
						handler : function(){
							$table.ajaxEnable({url : "${request.contextPath}/admin/app/enable"}, false);
						},
						show : function(d){
							return d.isEnable;
						}
					},
					{text : 'Enable', clazz : 'green', icon : 'fa fa-unlock', permission : '/admin/app/enable',
						handler : function(){
							$table.ajaxEnable({url : "${request.contextPath}/admin/app/enable"}, true);
						},
						show : function(d){
							return !d.isEnable;
						}
					},
					{text : 'Delete', clazz : 'red', icon : 'fa fa-trash-o', permission : '/admin/app/delete', handler : function(d, i){
							$table.ajaxDelete({
								confirm : "Deleting the application will also delete associated permissions. Confirm deletion?",
								url : "${request.contextPath}/admin/app/delete"
							});
						}},
					{text : 'View Application Credentials', clazz : 'blue', icon : 'fa fa-eye', permission : '/admin/app/credentials', handler : function(d, i){
							$("#_editForm")[0].reset();
							$.getJSON("${request.contextPath}/admin/app/credentials?id=" + d.id, function(d) {
								$("#_clientId").html(d.data.clientId);
								$("#_clientSecret").html(d.data.clientSecret);
								$("#my-modal-a").click();
							});
						}}
				],
				after : function(){
					// Permission handling
					$.permission();
				}
			});

			// Search
			$(".search-data").keyup(function () {
				$table.search();
			});
		});
	});
</script>