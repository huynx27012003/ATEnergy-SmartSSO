/**
 * jQuery Box 1.0
 */
var smart = smart ? smart : {};
(function(sm, $) {
	sm.box = {
		options : {
			// Type ["alert", "confirm"]
			type : "alert",
			// Whether to display the mask layer
			mask : true,
			// Auto close after (milliseconds)
			time : 0,

			// Message title
			title : 'Friendly Reminder',
			// Status style ['ok', 'warn']
			status : null,
			// Message content
			content : '',
			// Width
			width : 400,
			// Height
			height : 150,

			// Before closing callback
			beforeClose : function() {},
			// After closing callback
			afterClose : function() {},

			// When type is "confirm", confirm button callback
			confirmButton : "Confirm",
			confirm : function() {},
			cancelButton : "Cancel",
			cancel : function() {}
		},
		object : null, // Store the box object
		createMask : function () {
			return '<div id="_boxMask" class="box_mask" style="width: ' + $(document).width() + 'px; height: ' + $(document).height() + 'px"/>';
		},
		createTitle : function (o) {
			var html = '';
			html += '			<div class="box_title_bar">';
			html += '				<div class="box_title">' + o.title + '</div>';
			html += '				<a id="_boxClose" class="box_close">Ã—</a>';
			html += '			</div>';
			return html;
		},
		bindEvent : function (o) {
			$('#_boxClose').click(function(){
				sm.box.close();
			});

			$("#_boxConfirm").click(function() {
				o.confirm();
				sm.box.close();
			});

			$("#_boxCancle").click(function() {
				o.cancel();
				sm.box.close();
			});

			if(o.time > 0){
				setTimeout(function(){
					sm.box.close();
				}, o.time);
			}
		},
		unbindEvent : function (o) {
			$("#_boxClose").unbind("click");
			$("#_boxConfirm").unbind("click");
			$("#_boxCancle").unbind("click");
		},
		createContent : function (o) {
			var html = '';
			html += '			<div class="box_content">';
			html += '				<table>';
			html += '					<tr>';
			html += '						<td>';
			html += '							<span id="_boxStatus" class="box_status' + (o.status != null ? ' box_status_' + o.status : '') + '"/>';
			html += '						</td>';
			if (o.content != null) {
				html += '						<td id="_boxMessage" class="box_message">' + o.content + '</td>';
			}
			html += '					</tr>';
			html += '				</table>';
			html += '			</div>';
			return html;
		},
		createButton : function (o) {
			var html = '';
			html += '		<div class="box_dialog_Button">';
			html += '			<a id="_boxConfirm">' + o.confirmButton + '</a>';
			html += '			<a id="_boxCancle">' + o.cancelButton + '</a>';
			html += '		</div>';
			return html;
		},
		create : function (o) {
			var html = '';
			if(o.mask){
				html += sm.box.createMask();
			}
			html += '<div id="_boxContainer" class="box_container">';
			html += '	<div class="box_dialog" style="width: ' + o.width + 'px;">';
			if (o.content != null) {
				html += '		<div class="box_dialog_content"  style="width: ' + o.width + 'px; height: ' + o.height + 'px">';
				html += sm.box.createTitle(o);
				html += sm.box.createContent(o);
				html += '		</div>';
			}
			if(o.type == 'confirm'){
				html += sm.box.createButton(o);
			}
			html += '	</div>';
			html += '</div>';
			$('body').append(html);
		},
		destory : function () {
		},
		open : function(o) {
			o = $.extend({}, sm.box.options, o);
			// if(sm.box.object == null){
			sm.box.create(sm.box.object = o);
			// }
			sm.box.bindEvent(sm.box.object);
			if(o.mask){
				$("#_boxMask").show();
			}
			$("#_boxContainer").fadeIn(300);
		},
		close : function() {
			sm.box.object.beforeClose();
			sm.box.destory();
			sm.box.unbindEvent(sm.box.object);
			$("#_boxContainer").fadeOut(300);
			$("#_boxContainer").remove();
			if(sm.box.object.mask){
				$("#_boxMask").hide();
				$("#_boxMask").remove();
			}
			sm.box.object.afterClose();
		}
	};
})(smart, jQuery);

jQuery(function($) {
	$.box = function(c) {
		return smart.box.open(c);
	};

	$.boxClose = function(c) {
		return smart.box.close(c);
	};
});
